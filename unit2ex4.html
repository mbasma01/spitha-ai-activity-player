<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Prep: Attendance Data Cleaning</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Use Inter font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Highlight.js for syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f0f4f8; }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Custom Scrollbar for code blocks */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #2d3748; }
        ::-webkit-scrollbar-thumb { background: #4a5568; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #718096; }

        /* Table Styles */
        .dataframe-table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
        .dataframe-table th { background-color: #e2e8f0; text-align: left; padding: 8px; border-bottom: 2px solid #cbd5e1; color: #2d3748; }
        .dataframe-table td { padding: 8px; border-bottom: 1px solid #e2e8f0; color: #4a5568; }
        .dataframe-table tr:nth-child(even) { background-color: #f7fafc; }
        
        /* Highlight specific columns based on step */
        .highlight-col { background-color: #ebf8ff !important; font-weight: bold; color: #2b6cb0; }
        
        /* Flashcard Styles */
        .flashcard {
            background: linear-gradient(135deg, #fffbeb 0%, #fff7ed 100%);
            border-left: 4px solid #f59e0b;
        }
    </style>
</head>
<body class="text-slate-800 h-screen flex flex-col overflow-hidden">

    <!-- Header -->
    <header class="bg-white border-b border-slate-200 p-4 shadow-sm z-10">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <div class="bg-indigo-600 p-2 rounded-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                </div>
                <div>
                    <h1 class="text-xl font-bold text-slate-800">Attendance Data Cleaning</h1>
                    <p class="text-xs text-slate-500 font-medium">UNIT 2 • EXERCISE 4: TYPES & COLUMNS</p>
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <div class="text-sm font-medium text-slate-500">
                    Step <span id="current-step-display">1</span> of 10
                </div>
                <div class="w-32 h-2 bg-slate-200 rounded-full overflow-hidden">
                    <div id="progress-bar" class="h-full bg-indigo-500 transition-all duration-500 ease-out" style="width: 10%"></div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 flex overflow-hidden max-w-7xl mx-auto w-full">
        
        <!-- Left Panel: Instructions & Code -->
        <div class="w-1/2 p-6 overflow-y-auto border-r border-slate-200 bg-white flex flex-col">
            <div id="instruction-card" class="fade-in flex-1 flex flex-col">
                <!-- Dynamic Content Loads Here -->
            </div>
            
            <!-- Navigation Buttons -->
            <div class="mt-6 pt-6 border-t border-slate-100 flex justify-between items-center">
                <button onclick="prevStep()" id="prev-btn" class="px-4 py-2 text-slate-500 hover:text-slate-700 font-medium text-sm transition-colors disabled:opacity-30 disabled:cursor-not-allowed">
                    &larr; Previous
                </button>
                <div class="flex space-x-3">
                    <button onclick="revealCode()" id="reveal-btn" class="px-5 py-2.5 bg-indigo-50 text-indigo-700 hover:bg-indigo-100 rounded-lg font-semibold text-sm transition-colors border border-indigo-200">
                        Reveal Solution
                    </button>
                    <button onclick="nextStep()" id="next-btn" class="hidden px-5 py-2.5 bg-indigo-600 text-white hover:bg-indigo-700 rounded-lg font-semibold text-sm transition-transform active:scale-95 shadow-md shadow-indigo-200">
                        Run & Next &rarr;
                    </button>
                </div>
            </div>
        </div>

        <!-- Right Panel: Data Visualization -->
        <div class="w-1/2 bg-slate-50 flex flex-col">
            <div class="p-3 border-b border-slate-200 bg-white flex justify-between items-center">
                <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wider">DataFrame Preview</h3>
                <span class="px-2 py-1 bg-green-100 text-green-700 text-xs rounded font-mono">df.head(5)</span>
            </div>
            <div class="flex-1 p-6 overflow-auto" id="data-display-area">
                <!-- Table renders here -->
                <div class="bg-white rounded-lg shadow-sm border border-slate-200 overflow-hidden" id="dataframe-container">
                    <table class="dataframe-table">
                        <thead id="table-head"></thead>
                        <tbody id="table-body"></tbody>
                    </table>
                </div>
                
                <!-- Console/Info Output -->
                <div class="mt-4 bg-slate-800 rounded-lg p-4 font-mono text-xs text-slate-300 shadow-inner">
                    <div class="flex items-center mb-2 border-b border-slate-700 pb-2">
                        <span class="text-yellow-400 mr-2">●</span> Output Log:
                    </div>
                    <div id="console-output" class="space-y-1">
                        <!-- Dynamic Info -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // --- DATA MANAGEMENT ---
        // We use functions to reconstruct data to ensure robustness when moving Prev/Next
        function getInitialData() {
            return [
                { student_id: 200.99, age: 17, gender: 'male', study_hours: 3.63, sleep_hours: 7.24, attendance: 1 },
                { student_id: 201.05, age: 23, gender: 'other', study_hours: 4.39, sleep_hours: 7.98, attendance: 0 },
                { student_id: 202.33, age: 22, gender: 'male', study_hours: 5.43, sleep_hours: 6.53, attendance: 1 },
                { student_id: 203.41, age: 20, gender: 'female', study_hours: 1.77, sleep_hours: 9.35, attendance: 0 },
                { student_id: 204.12, age: 19, gender: 'female', study_hours: 4.80, sleep_hours: 8.50, attendance: 1 }
            ];
        }

        let currentData = [];
        let currentColumns = [];
        
        // --- TRANSFORM FUNCTIONS ---
        // Renamed variable T to TransformActions to avoid global scope conflict
        const TransformActions = {
            reset: () => {
                currentData = getInitialData();
                currentColumns = ['student_id', 'age', 'gender', 'study_hours', 'sleep_hours', 'attendance'];
            },
            castId: () => {
                currentData.forEach(r => r.student_id = Math.floor(r.student_id));
            },
            renameId: () => {
                currentData = currentData.map(r => {
                    r['ID'] = r['student_id'];
                    delete r['student_id'];
                    return r;
                });
                const idx = currentColumns.indexOf('student_id');
                if (idx !== -1) currentColumns[idx] = 'ID';
            },
            overwriteHeaders: () => {
                // Current order expected: ID, age, gender, study_hours, sleep_hours, attendance
                currentColumns = ['ID', 'Age', 'Gender', 'Study', 'Sleep', 'Attend'];
                // Remap data keys
                currentData = currentData.map(r => ({
                    'ID': r.ID || r.student_id,
                    'Age': r.age,
                    'Gender': r.gender,
                    'Study': r.study_hours,
                    'Sleep': r.sleep_hours,
                    'Attend': r.attendance
                }));
            },
            addSemester: () => {
                currentData.forEach(r => r['Semester'] = 1);
                if (!currentColumns.includes('Semester')) currentColumns.push('Semester');
            },
            mathTotal: () => {
                currentData.forEach(r => r['Total_Time'] = r['Study'] + r['Sleep']);
                if (!currentColumns.includes('Total_Time')) currentColumns.push('Total_Time');
            },
            roundTotal: () => {
                currentData.forEach(r => r['Total_Time'] = parseFloat(r['Total_Time'].toFixed(1)));
            },
            upperGender: () => {
                currentData.forEach(r => r['Gender'] = r['Gender'].toUpperCase());
            },
            concatDesc: () => {
                currentData.forEach(r => r['Description'] = r['Gender'] + " STUDENT");
                if (!currentColumns.includes('Description')) currentColumns.push('Description');
            },
            dropId: () => {
                currentData.forEach(r => delete r['ID']);
                currentColumns = currentColumns.filter(c => c !== 'ID');
            }
        };

        // --- EXERCISE STEPS CONFIGURATION ---
        const steps = [
            {
                title: "1. Loading & Inspecting",
                flashcard: {
                    title: "Data Types: The Shape of Data",
                    content: "Types rule everything. <br><br><span class='font-bold text-blue-600'>Float</span> = Decimals (200.99)<br><span class='font-bold text-green-600'>Int</span> = Whole Numbers (200)<br><span class='font-bold text-red-600'>Object</span> = Text"
                },
                instruction: "We loaded the CSV. Look at <code>student_id</code>. It is a <strong>Float</strong> (200.99), but IDs should usually be whole numbers. We need to fix this.",
                task: "Write the code to load the data from the URL.",
                code: "import pandas as pd\n\nurl = 'https://raw.githubusercontent.com/mbasma01/spitha-ai-notebooks/main/Attendance_Prediction.csv'\ndf = pd.read_csv(url)\n\ndf.head()",
                explanation: "We load from a URL. Notice the decimals in the ID column? That's messy.",
                action: () => { 
                    TransformActions.reset();
                    renderTable();
                    renderConsole("Data loaded. student_id dtype: float64");
                }
            },
            {
                title: "2. Type Conversion (Casting)",
                flashcard: {
                    title: "Casting: .astype()",
                    content: "Casting is forcing data into a new mold. <br><code>.astype(int)</code> chops off decimals.<br><code>.astype(str)</code> turns numbers into text."
                },
                instruction: "The <code>student_id</code> shouldn't have decimals. Let's convert (cast) it to an <strong>Integer</strong>.",
                task: "Use <code>.astype(int)</code> to fix the 'student_id' column.",
                code: "# Convert column type to Integer\ndf['student_id'] = df['student_id'].astype(int)\n\ndf.head()",
                explanation: "This forces the column to become whole numbers. 200.99 becomes 200. Much cleaner!",
                action: () => {
                    TransformActions.reset(); TransformActions.castId();
                    renderTable('student_id');
                    renderConsole("student_id converted to int64");
                }
            },
            {
                title: "3. Renaming a Single Column",
                flashcard: {
                    title: "Dictionaries: {'Old': 'New'}",
                    content: "A Dictionary is a translation map. <br>Pandas scans headers, finds the 'Old' key, and swaps it for 'New'."
                },
                instruction: "<code>student_id</code> is too long. Let's rename just this one column to <code>ID</code>.",
                task: "Use <code>.rename()</code> to change 'student_id' to 'ID'.",
                code: "# Rename specific columns\ndf = df.rename(columns={'student_id': 'ID'})\n\ndf.head()",
                explanation: "The dictionary <code>{'student_id': 'ID'}</code> maps the old name to the new name.",
                action: () => {
                    TransformActions.reset(); TransformActions.castId(); TransformActions.renameId();
                    renderTable('ID');
                    renderConsole("Renamed: student_id -> ID");
                }
            },
            {
                title: "4. Overwriting All Headers",
                flashcard: {
                    title: "Lists: The Sticker Sheet",
                    content: "<code>df.columns = [...]</code> replaces ALL headers. <br><strong>Warning:</strong> The list must match the column order exactly!"
                },
                instruction: "Let's standardize ALL column names to be Capitalized. We can assign a list of names directly.",
                task: "Assign a new list of names to <code>df.columns</code>.",
                code: "# Overwrite all column names\ndf.columns = ['ID', 'Age', 'Gender', 'Study', 'Sleep', 'Attend']\n\ndf.head()",
                explanation: "This is faster than renaming 6 columns one by one, but you must be careful with the order.",
                action: () => {
                    TransformActions.reset(); TransformActions.castId(); TransformActions.renameId(); TransformActions.overwriteHeaders();
                    renderTable();
                    renderConsole("All headers updated.");
                }
            },
            {
                title: "5. Broadcasting (New Column)",
                flashcard: {
                    title: "Broadcasting",
                    content: "If you assign a single value (scalar) to a new column, Pandas 'broadcasts' (repeats) it for every single row."
                },
                instruction: "We forgot to track the Semester! Since all this data is from Semester 1, let's add a column where every row is <code>1</code>.",
                task: "Create a new column 'Semester' and set it to 1.",
                code: "# Assigning a single value fills the whole column\ndf['Semester'] = 1\n\ndf.head()",
                explanation: "We didn't need a list of 1s. We just gave it one number, and Pandas did the rest.",
                action: () => {
                    TransformActions.reset(); TransformActions.castId(); TransformActions.renameId(); TransformActions.overwriteHeaders(); TransformActions.addSemester();
                    renderTable('Semester');
                    renderConsole("New Column: Semester (value=1)");
                }
            },
            {
                title: "6. Math on Columns",
                flashcard: {
                    title: "Vectorization",
                    content: "Math aligns by row. <br><code>Col A + Col B</code> adds Row 1 to Row 1, Row 2 to Row 2, etc."
                },
                instruction: "Let's calculate the <code>Total_Time</code> a student is busy (Study + Sleep).",
                task: "Add the 'Study' and 'Sleep' columns.",
                code: "# Add two columns together\ndf['Total_Time'] = df['Study'] + df['Sleep']\n\ndf.head()",
                explanation: "Because these are Floats, <code>+</code> does math. (3.63 + 7.24 = 10.87)",
                action: () => {
                    TransformActions.reset(); TransformActions.castId(); TransformActions.renameId(); TransformActions.overwriteHeaders(); TransformActions.addSemester(); TransformActions.mathTotal();
                    renderTable('Total_Time');
                    renderConsole("Calculated Total_Time");
                }
            },
            {
                title: "7. Rounding Values",
                flashcard: {
                    title: "Method Chaining",
                    content: "<code>.round(1)</code> keeps 1 decimal place. <br>Precision is key for clean reports."
                },
                instruction: "The <code>Total_Time</code> has too many decimals. Let's round it to 1 decimal place.",
                task: "Apply <code>.round(1)</code> to the 'Total_Time' column.",
                code: "# Round to 1 decimal place\ndf['Total_Time'] = df['Total_Time'].round(1)\n\ndf.head()",
                explanation: "Cleaning numerical noise is a standard step in data prep.",
                action: () => {
                    TransformActions.reset(); TransformActions.castId(); TransformActions.renameId(); TransformActions.overwriteHeaders(); TransformActions.addSemester(); TransformActions.mathTotal(); TransformActions.roundTotal();
                    renderTable('Total_Time');
                    renderConsole("Total_Time rounded to 1 decimal");
                }
            },
            {
                title: "8. String Methods (.str)",
                flashcard: {
                    title: "Accessor: .str",
                    content: "To edit text inside a Series, unlock it with <code>.str</code>. <br><code>.str.upper()</code>, <code>.str.lower()</code>, <code>.str.replace()</code>"
                },
                instruction: "Let's clean the <code>Gender</code> column. Convert it to UPPERCASE.",
                task: "Use <code>.str.upper()</code> on the Gender column.",
                code: "# Access string methods\ndf['Gender'] = df['Gender'].str.upper()\n\ndf.head()",
                explanation: "Without <code>.str</code>, Pandas treats the column as a generic object and won't let you edit the text inside.",
                action: () => {
                    TransformActions.reset(); TransformActions.castId(); TransformActions.renameId(); TransformActions.overwriteHeaders(); TransformActions.addSemester(); TransformActions.mathTotal(); TransformActions.roundTotal(); TransformActions.upperGender();
                    renderTable('Gender');
                    renderConsole("Gender converted to UPPERCASE");
                }
            },
            {
                title: "9. String Concatenation",
                flashcard: {
                    title: "Gluing Text",
                    content: "For strings, the <code>+</code> symbol is glue. <br><code>'Hello' + ' ' + 'World'</code> = <code>'Hello World'</code>"
                },
                instruction: "Let's create a full text description. Combine the <code>Gender</code> with the word ' STUDENT'.",
                task: "Create 'Description' by adding 'Gender' and a string.",
                code: "# Concatenate strings\ndf['Description'] = df['Gender'] + \" STUDENT\"\n\ndf.head()",
                explanation: "Notice we added a space inside the quotes <code>\" STUDENT\"</code> so the words don't mash together.",
                action: () => {
                    TransformActions.reset(); TransformActions.castId(); TransformActions.renameId(); TransformActions.overwriteHeaders(); TransformActions.addSemester(); TransformActions.mathTotal(); TransformActions.roundTotal(); TransformActions.upperGender(); TransformActions.concatDesc();
                    renderTable('Description');
                    renderConsole("Created Description column");
                }
            },
            {
                title: "10. Dropping Columns",
                flashcard: {
                    title: "Dropping Data",
                    content: "<code>.drop(columns=[...])</code> removes data. <br>Always easier to drop columns at the end than filtering early."
                },
                instruction: "We are done! We don't need the <code>ID</code> column for our final report. Let's delete it.",
                task: "Use <code>.drop()</code> to remove the 'ID' column.",
                code: "# Remove a column\ndf = df.drop(columns=['ID'])\n\ndf.head()",
                explanation: "The column is gone. Your data is clean, typed, calculated, and ready!",
                action: () => {
                    TransformActions.reset(); TransformActions.castId(); TransformActions.renameId(); TransformActions.overwriteHeaders(); TransformActions.addSemester(); TransformActions.mathTotal(); TransformActions.roundTotal(); TransformActions.upperGender(); TransformActions.concatDesc(); TransformActions.dropId();
                    renderTable();
                    renderConsole("Dropped ID column");
                }
            }
        ];

        // --- APP STATE ---
        let currentStep = 0;
        let isCodeRevealed = false;

        // --- DOM ELEMENTS ---
        const instructionCard = document.getElementById('instruction-card');
        const progressBar = document.getElementById('progress-bar');
        const currentStepDisplay = document.getElementById('current-step-display');
        const revealBtn = document.getElementById('reveal-btn');
        const nextBtn = document.getElementById('next-btn');
        const prevBtn = document.getElementById('prev-btn');
        const tableHead = document.getElementById('table-head');
        const tableBody = document.getElementById('table-body');
        const consoleOutput = document.getElementById('console-output');

        // --- INITIALIZATION ---
        function init() {
            renderContent();
            steps[0].action(); // Run initial state setup
        }

        // --- RENDERING ---
        function renderContent() {
            const step = steps[currentStep];
            
            // Update Header info
            currentStepDisplay.innerText = currentStep + 1;
            const progress = ((currentStep + 1) / steps.length) * 100;
            progressBar.style.width = `${progress}%`;
            
            // Generate Flashcard HTML
            const flashcardHtml = step.flashcard ? `
                <div class="flashcard rounded-lg p-4 mb-6 shadow-sm relative overflow-hidden group">
                    <div class="absolute top-0 right-0 p-2 opacity-10 group-hover:opacity-20 transition-opacity">
                        <svg class="w-16 h-16 text-amber-500" fill="currentColor" viewBox="0 0 20 20"><path d="M9 4.804A7.968 7.968 0 005.5 4c-1.255 0-2.443.29-3.5.804v10A7.969 7.969 0 015.5 14c1.669 0 3.218.51 4.5 1.385A7.962 7.962 0 0114.5 14c1.255 0 2.443.29 3.5.804v-10A7.968 7.968 0 0014.5 4c-1.255 0-2.443.29-3.5.804V12a1 1 0 11-2 0V4.804z"/></svg>
                    </div>
                    <h3 class="text-amber-800 font-bold text-xs uppercase tracking-wide mb-2 flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        Concept Card: ${step.flashcard.title}
                    </h3>
                    <p class="text-amber-900 text-sm relative z-10 leading-relaxed">${step.flashcard.content}</p>
                </div>
            ` : '';
            
            // Update Instructions
            instructionCard.innerHTML = `
                <div class="mb-4">
                    <span class="inline-block px-2 py-1 bg-indigo-100 text-indigo-700 text-xs font-bold rounded uppercase tracking-wide">Step ${currentStep + 1}</span>
                    <h2 class="text-2xl font-bold text-slate-800 mt-2">${step.title}</h2>
                </div>
                
                ${flashcardHtml}
                
                <div class="prose prose-slate text-sm text-slate-600 mb-6 flex-grow">
                    <p class="mb-4 text-base">${step.instruction}</p>
                    <div class="bg-indigo-50 border-l-4 border-indigo-400 p-4 mb-4">
                        <p class="font-bold text-indigo-800 text-xs uppercase mb-1">Your Task</p>
                        <p class="font-medium text-indigo-900">${step.task}</p>
                    </div>
                </div>

                <!-- Code Section (Hidden initially) -->
                <div id="code-section" class="relative rounded-lg overflow-hidden bg-slate-900 shadow-lg transition-all duration-300 ${isCodeRevealed ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-4 hidden'}">
                    <div class="flex justify-between items-center px-4 py-2 bg-slate-800 border-b border-slate-700">
                        <span class="text-xs font-mono text-slate-400">solution.py</span>
                        <button onclick="copyToClipboard()" class="text-xs text-slate-400 hover:text-white transition-colors flex items-center gap-1">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 012 2v8a2 2 0 01-2 2h-8a2 2 0 01-2-2v-8a2 2 0 012-2h8a2 2 0 012 2v8a2 2 0 01-2 2H8z" /></svg>
                            Copy
                        </button>
                    </div>
                    <pre class="m-0 p-4 text-sm font-mono text-slate-300 overflow-x-auto"><code class="language-python">${step.code}</code></pre>
                    <div class="px-4 py-3 bg-indigo-900/30 border-t border-slate-700">
                        <p class="text-xs text-indigo-200"><strong>Insight:</strong> ${step.explanation}</p>
                    </div>
                </div>
            `;

            // Highlight Code
            if (isCodeRevealed) {
                hljs.highlightAll();
            }

            // Button States
            prevBtn.disabled = currentStep === 0;
            if (isCodeRevealed) {
                revealBtn.classList.add('hidden');
                nextBtn.classList.remove('hidden');
            } else {
                revealBtn.classList.remove('hidden');
                nextBtn.classList.add('hidden');
            }
        }

        function renderTable(highlightColName = null) {
            // Render Headers
            let headersHtml = '<tr>';
            currentColumns.forEach(col => {
                const isHighlighted = col === highlightColName ? 'highlight-col' : '';
                headersHtml += `<th class="${isHighlighted}">${col}</th>`;
            });
            headersHtml += '</tr>';
            tableHead.innerHTML = headersHtml;

            // Render Rows
            let rowsHtml = '';
            currentData.forEach(row => {
                rowsHtml += '<tr>';
                currentColumns.forEach(col => {
                    let val = row[col];
                    // Formatting for nicer display
                    // Check for raw integer vs float
                    if (typeof val === 'number' && !Number.isInteger(val)) val = val.toFixed(2);
                    
                    const isHighlighted = col === highlightColName ? 'highlight-col' : '';
                    rowsHtml += `<td class="${isHighlighted}">${val !== undefined ? val : '-'}</td>`;
                });
                rowsHtml += '</tr>';
            });
            tableBody.innerHTML = rowsHtml;
        }

        function renderConsole(text) {
            consoleOutput.innerText = text;
        }

        // --- ACTIONS ---
        function revealCode() {
            isCodeRevealed = true;
            renderContent();
        }

        function nextStep() {
            if (currentStep < steps.length - 1) {
                currentStep++;
                isCodeRevealed = false; // Reset for next task
                
                // Execute the logic for the NEW step immediately
                steps[currentStep].action(); 
                
                renderContent();
            } else {
                alert("Exercise Complete! You've mastered Types and Column operations.");
                // Optional: Reset
                currentStep = 0;
                isCodeRevealed = false;
                steps[0].action();
                renderContent();
            }
        }

        function prevStep() {
            if (currentStep > 0) {
                currentStep--;
                isCodeRevealed = false;
                // We need to re-run the action for the previous step to restore state
                steps[currentStep].action();
                renderContent();
            }
        }

        function copyToClipboard() {
            const text = steps[currentStep].code;
            
            // Try modern API first
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text)
                    .then(() => {
                        alert("Code copied!");
                    })
                    .catch(err => {
                        console.warn('Clipboard API failed, trying fallback...', err);
                        fallbackCopyTextToClipboard(text);
                    });
            } else {
                fallbackCopyTextToClipboard(text);
            }
        }

        function fallbackCopyTextToClipboard(text) {
            var textArea = document.createElement("textarea");
            textArea.value = text;
            
            // Avoid scrolling to bottom
            textArea.style.top = "0";
            textArea.style.left = "0";
            textArea.style.position = "fixed";
            
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                var successful = document.execCommand('copy');
                var msg = successful ? 'successful' : 'unsuccessful';
                console.log('Fallback: Copying text command was ' + msg);
                if (successful) {
                     alert("Code copied!");
                } else {
                     alert("Unable to copy code automatically. Please manually select and copy.");
                }
            } catch (err) {
                console.error('Fallback: Oops, unable to copy', err);
                alert("Unable to copy code automatically. Please manually select and copy.");
            }
            
            document.body.removeChild(textArea);
        }

        // Start
        init();

    </script>
</body>
</html>